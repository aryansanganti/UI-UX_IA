<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Microinteractions Demo</title>
  <link rel="stylesheet" href="style.css">
  <!-- Google Material Symbols for Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
</head>

<body>
  <h1>Aryan Sanganti 16014123014 CCE UI/UX IA-1</h1>
  <h2>Microinteractions: Notification Bell & Toast Queue</h2>

  <!-- ========== A: Notification Bell ========== -->
  <div class="notification-wrapper">
    <button id="notif-bell" class="notification-bell">
      <span class="material-symbols-outlined">notifications</span>
      <span id="notif-count" class="badge">0</span>
    </button>

    <div id="notif-dropdown" class="notification-dropdown">
      <p class="notif-header">Notifications</p>
      <ul id="notif-list">
        <!-- Notifications will be injected here -->
      </ul>
      <button id="mark-read" class="mark-read-btn">Mark all as read</button>
    </div>
  </div>

  <button id="add-notif" class="action-btn">Add New Notification</button>

  <!-- ========== B: Toast Notification Queue ========== -->
  <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <button id="show-toast" class="action-btn">Show Toast</button>

  <script>
    /* ==================== A: Notification Bell ==================== */
    const notifBell = document.getElementById("notif-bell");
    const notifDropdown = document.getElementById("notif-dropdown");
    const notifCount = document.getElementById("notif-count");
    const notifList = document.getElementById("notif-list");
    const markReadBtn = document.getElementById("mark-read");
    const addNotifBtn = document.getElementById("add-notif");

    let notifications = [];
    let unreadCount = 0;

    function updateBadge() {
      notifCount.textContent = unreadCount;
      notifCount.style.display = unreadCount > 0 ? "inline-block" : "none";
    }

    function addNotification(message) {
      const notificationId = Date.now(); // Unique ID for each notification
      notifications.unshift({ id: notificationId, message });
      unreadCount++;
      updateBadge();
      notifBell.classList.add("shake");
      setTimeout(() => notifBell.classList.remove("shake"), 600);

      const li = document.createElement("li");
      li.className = "notification-item";
      li.innerHTML = `
        <span class="notification-text">${message}</span>
        <button class="notification-close" onclick="removeNotification(${notificationId})">
          <span class="material-symbols-outlined">close</span>
        </button>
      `;
      notifList.prepend(li);
    }

    function removeNotification(id) {
      // Remove from array
      notifications = notifications.filter(notif => notif.id !== id);
      
      // Find and remove the DOM element
      const notifItems = document.querySelectorAll('.notification-item');
      notifItems.forEach(item => {
        const closeBtn = item.querySelector('.notification-close');
        if (closeBtn && closeBtn.onclick.toString().includes(id)) {
          item.remove();
          unreadCount--;
          updateBadge();
        }
      });
    }

    notifBell.addEventListener("click", () => {
      notifDropdown.classList.toggle("open");
    });

    markReadBtn.addEventListener("click", () => {
      unreadCount = 0;
      updateBadge();
      notifications = [];
      notifList.innerHTML = "";
    });

    addNotifBtn.addEventListener("click", () => {
      addNotification(`New message at ${new Date().toLocaleTimeString()}`);
    });

    /* ==================== B: Toast Notifications ==================== */
    const toastContainer = document.getElementById("toast-container");
    const showToastBtn = document.getElementById("show-toast");

    function createToast(message, duration = 3000) {
      const toast = document.createElement("div");
      toast.className = "toast";
      toast.setAttribute("role", "status");
      toast.textContent = message;

      let dismissTimeout = setTimeout(() => removeToast(toast), duration);

      toast.addEventListener("mouseenter", () => clearTimeout(dismissTimeout));
      toast.addEventListener("mouseleave", () => {
        dismissTimeout = setTimeout(() => removeToast(toast), duration);
      });

      toastContainer.appendChild(toast);
      requestAnimationFrame(() => toast.classList.add("show"));
    }

    function removeToast(toast) {
      toast.classList.remove("show");
      setTimeout(() => toast.remove(), 300);
    }

    showToastBtn.addEventListener("click", () => {
      createToast(`Toast at ${new Date().toLocaleTimeString()}`);
    });
  </script>
</body>

</html>